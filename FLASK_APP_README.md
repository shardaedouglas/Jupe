# US Weather Anomaly Detection Web Interface

A Flask-based web application that provides an interactive interface for running weather anomaly detection on US GHCN-Daily stations.

## Features

### üåê **Interactive Web Interface**
- **Station Selection**: Choose from 75,847+ US weather stations
- **Date Range Selection**: Analyze specific time periods
- **Method Selection**: Choose between statistical and machine learning approaches
- **Confidence Thresholds**: Adjustable sensitivity levels

### üìä **Comprehensive Analysis**
- **Real-time Detection**: Run anomaly detection with a single click
- **Multiple Algorithms**: Statistical (Z-score) and ML (Isolation Forest, LOF, One-Class SVM)
- **Visual Reports**: Interactive charts and graphs
- **Detailed Results**: Comprehensive anomaly listings

### üìà **Visualizations**
- **Temperature Timeline**: Temperature trends with anomaly highlights
- **Precipitation Timeline**: Precipitation patterns with anomaly markers
- **Anomaly Summary**: Comparative analysis across detection methods
- **Geographic Context**: Station location and metadata

### üìã **Report Generation**
- **Export Capabilities**: Download reports as JSON
- **Summary Statistics**: Data quality scores and coverage metrics
- **Anomaly Details**: Detailed information for each detected anomaly
- **QA Integration**: Quality assurance metrics and flags

## Installation

### **Prerequisites**
- Python 3.8+
- Required Python packages (see requirements_flask.txt)

### **Quick Setup**
```bash
# Install dependencies
pip install -r requirements_flask.txt

# Generate US station data (if not already done)
python run_us_filter.py

# Launch the web interface
python launch_app.py
```

### **Manual Setup**
```bash
# Install Flask and dependencies
pip install Flask pandas numpy matplotlib seaborn scikit-learn requests

# Run the application
python app.py
```

## Usage

### **1. Access the Interface**
- Open your web browser
- Navigate to `http://localhost:5000`
- The interface will load with available US stations

### **2. Select a Station**
- Choose a US weather station from the dropdown
- View station details (location, elevation, state)
- Available data range will be automatically populated

### **3. Configure Analysis**
- **Date Range**: Select start and end dates for analysis
- **Confidence Threshold**: Choose sensitivity level (0.3-0.9)
- **Methods**: Select detection algorithms (Statistical, ML, or both)

### **4. Run Analysis**
- Click "Run Anomaly Detection"
- Wait for processing (typically 10-30 seconds)
- View results in the interface

### **5. Review Results**
- **Summary Cards**: Total anomalies, data quality, analysis period
- **Visualizations**: Interactive charts showing anomalies
- **Anomaly Details**: Specific anomaly information
- **Export Options**: Download comprehensive reports

## API Endpoints

### **GET /api/stations**
Returns list of available US stations with metadata.

**Response:**
```json
{
  "stations": [
    {
      "id": "USC00086700",
      "name": "OXFORD FL US",
      "state": "FL",
      "latitude": 28.933333,
      "longitude": -82.033333,
      "elevation": 50.0
    }
  ]
}
```

### **GET /api/station/{station_id}/data**
Returns weather data and summary for a specific station.

**Response:**
```json
{
  "station_id": "USC00086700",
  "summary": {
    "total_records": 1534,
    "date_range": {
      "start": "1892-03-16",
      "end": "2023-12-31"
    },
    "temperature_records": 379,
    "precipitation_records": 1374
  },
  "data": [...]
}
```

### **POST /api/anomaly-detection**
Runs anomaly detection for specified parameters.

**Request:**
```json
{
  "station_id": "USC00086700",
  "start_date": "2023-01-01",
  "end_date": "2023-12-31",
  "confidence_threshold": 0.5,
  "methods": ["statistical", "ml"]
}
```

**Response:**
```json
{
  "station_id": "USC00086700",
  "analysis_date": "2024-01-15 10:30:00",
  "data_summary": {...},
  "anomalies": {
    "statistical": {...},
    "ml": {...}
  },
  "summary": {...},
  "visualizations": {...}
}
```

### **POST /api/export-report**
Exports anomaly report as downloadable JSON file.

### **GET /download/{filename}**
Downloads exported report files.

## Configuration

### **Environment Variables**
- `FLASK_ENV`: Set to 'development' for debug mode
- `FLASK_DEBUG`: Enable/disable debug mode
- `PORT`: Custom port (default: 5000)

### **Data Sources**
- **Stations**: `us_stations.csv` (generated by us_station_filter.py)
- **Weather Data**: `us_enhanced_weather_data.csv`
- **Anomaly Detector**: `enhanced_weather_anomaly_detector.py`

## File Structure

```
‚îú‚îÄ‚îÄ app.py                              # Main Flask application
‚îú‚îÄ‚îÄ launch_app.py                       # Application launcher
‚îú‚îÄ‚îÄ templates/
‚îÇ   ‚îî‚îÄ‚îÄ index.html                      # Web interface template
‚îú‚îÄ‚îÄ static/                             # Static assets (CSS, JS)
‚îú‚îÄ‚îÄ us_stations.csv                     # US station metadata
‚îú‚îÄ‚îÄ us_enhanced_weather_data.csv        # Enhanced weather data
‚îú‚îÄ‚îÄ enhanced_weather_anomaly_detector.py # Anomaly detection module
‚îú‚îÄ‚îÄ requirements_flask.txt              # Python dependencies
‚îî‚îÄ‚îÄ README.md                           # This file
```

## Troubleshooting

### **Common Issues**

#### **1. "No station data available"**
- **Cause**: Missing `us_stations.csv` file
- **Solution**: Run `python run_us_filter.py` to generate station data

#### **2. "Anomaly detector not initialized"**
- **Cause**: Missing `enhanced_weather_anomaly_detector.py`
- **Solution**: Ensure the anomaly detection module exists

#### **3. "No weather data available"**
- **Cause**: Missing `us_enhanced_weather_data.csv`
- **Solution**: Run `python run_us_filter.py` to generate weather data

#### **4. Import errors**
- **Cause**: Missing Python packages
- **Solution**: Install requirements with `pip install -r requirements_flask.txt`

#### **5. Port already in use**
- **Cause**: Another process using port 5000
- **Solution**: Kill the process or change the port in `app.py`

### **Performance Optimization**

#### **For Large Datasets**
- **Caching**: Enable model caching for faster subsequent runs
- **Batch Processing**: Process multiple stations simultaneously
- **Data Filtering**: Pre-filter data by date range

#### **For Production Deployment**
- **WSGI Server**: Use Gunicorn or uWSGI instead of Flask dev server
- **Database**: Store results in database instead of JSON files
- **Load Balancing**: Use multiple worker processes

## Advanced Usage

### **Custom Detection Methods**
```python
# Add custom detection methods in app.py
def custom_anomaly_detection(data):
    # Your custom algorithm here
    return anomalies
```

### **Extended Visualizations**
```python
# Add custom visualizations in generate_visualizations()
def custom_chart(data, results):
    # Your custom chart here
    return base64_image
```

### **API Integration**
```python
# Integrate with external APIs
import requests

def get_weather_alerts(station_id):
    # Fetch weather alerts from external API
    return alerts
```

## Security Considerations

### **Production Deployment**
- **HTTPS**: Use SSL certificates for secure communication
- **Authentication**: Implement user authentication if needed
- **Input Validation**: Validate all user inputs
- **Rate Limiting**: Implement API rate limiting

### **Data Privacy**
- **Data Retention**: Implement data retention policies
- **Access Control**: Restrict access to sensitive data
- **Audit Logging**: Log all user actions

## Contributing

### **Development Setup**
1. Fork the repository
2. Create a feature branch
3. Make your changes
4. Test thoroughly
5. Submit a pull request

### **Code Style**
- Follow PEP 8 guidelines
- Use type hints where appropriate
- Add docstrings to functions
- Include unit tests

## License

This project is licensed under the MIT License - see the LICENSE file for details.

## Support

For issues and questions:
1. Check the troubleshooting section
2. Review the API documentation
3. Create an issue on GitHub
4. Contact the development team

## Changelog

### **Version 1.0.0**
- Initial release
- Basic anomaly detection interface
- Station selection and date range filtering
- Statistical and ML detection methods
- Report generation and export

### **Future Releases**
- Real-time data updates
- Advanced visualization options
- Machine learning model training interface
- Multi-station comparison analysis
